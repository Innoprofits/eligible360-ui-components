class EligibleCondition{constructor(e){this.el=document.querySelector(e.el),this.onAnswer=e.onAnswer,this.labels={next:e.next_label||"Suivant"}}mountComponent(e){this.el.innerHTML="",this.el.append(e)}render(e){let t=()=>{switch(e.input){case"Boolean":return this.renderBoolean(e);case"Text":return this.renderText(e);case"Select":return this.renderSelect(e);case"Radio":return this.renderRadio(e);case"Checkbox":return this.renderCheckbox(e)}};return e.pre_condition_activated?this.renderPreCondition(e,()=>t()):t()}_createContentElement(e){let t=document.createElement("div");return t.classList.add("eligible_condition"),t.innerHTML=`<p class="content">${e}</p>`,t}_createButton(e,t,n=null){let o=document.createElement("button");return o.type="button",o.innerText=e,o.onclick=(()=>t()),n&&o.classList.add(n),o}renderBoolean(e){let t=this._createContentElement(e.content),n=this._createButton("Non",()=>this.onAnswer(e.id,0),"negative"),o=this._createButton("Oui",()=>this.onAnswer(e.id,1),"positive");t.append(n),t.append(o),this.mountComponent(t)}renderPreCondition(e,t){let n=this._createContentElement(e.pre_condition_content),o=this._createButton(e.negative_answer_label,()=>this.onAnswer(e.id,"_IGNORE_"),"precondition_skip"),i=this._createButton(e.positive_answer_label,()=>t(),"precondition_next");n.append(o),n.append(i),this.mountComponent(n)}renderText(e){let t=this._createContentElement(e.content),n=document.createElement("input");n.type="text",n.oninput=(()=>{n.classList.remove("validation_error"),o.classList.remove("validation_error")});let o=document.createElement("p");o.classList.add("validation_text"),o.innerText=e.configuration.validation_reqs;let i=this._createButton(this.labels.next,()=>{if(e.configuration.pattern&&!n.value.match(e.configuration.pattern))return o.classList.add("validation_error"),void n.classList.add("validation_error");this.onAnswer(e.id,n.value)},"next");t.append(n),t.append(o),t.append(i),this.mountComponent(t)}renderSelect(e){let t=this._createContentElement(e.content),n=document.createElement("select");e.configuration.options.forEach(e=>{let t=document.createElement("option");t.value=e.id,t.innerText=e.value,n.append(t)});let o=this._createButton(this.labels.next,()=>this.onAnswer(e.id,n.value),"next");t.append(n),t.append(o),this.mountComponent(t)}renderRadio(e){let t=this._createContentElement(e.content);e.configuration.options.forEach(n=>{let o=document.createElement("label"),i=document.createElement("input");i.type="radio",i.name=e.id,i.value=n.id,o.append(i),o.append(n.value),t.append(o)});let n=this._createButton(this.labels.next,()=>{this.onAnswer(e.id,document.querySelector(`input[name=${e.id}]:checked`).value)},"next");t.append(n),this.mountComponent(t)}renderCheckbox(e){let t=this._createContentElement(e.content);e.configuration.options.forEach(n=>{let o=document.createElement("label"),i=document.createElement("input");i.type="checkbox",i.name=e.id,i.value=n.id,o.append(i),o.append(n.value),t.append(o)});let n=this._createButton(this.labels.next,()=>{this.onAnswer(e.id,Array.from(document.querySelectorAll(`input[name=${e.id}]:checked`)).map(e=>e.value))},"next");t.append(n),this.mountComponent(t)}}
